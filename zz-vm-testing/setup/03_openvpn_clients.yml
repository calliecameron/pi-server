---
- name: 03-openvpn-clients - install client certs
  when: openvpn_role == "client"
  become: yes
  package: name="{{ inventory_hostname }}-client-certs"
- name: 03-openvpn-clients - client config
  when: openvpn_role == "server"
  become: yes
  template:
    src: openvpn-client-config
    dest: "/etc/pi-server/openvpn-client-config.d/{{ openvpn_client_name }}-client"
    owner: root
    mode: a=r
- name: 03-openvpn-clients - server to server config
  when: openvpn_role == "server"
  become: yes
  template:
    src: openvpn-server-to-server-config
    dest: /etc/pi-server/openvpn-server-to-server-clients
    owner: root
    mode: a=r
- name: 03-openvpn-clients - don't autostart
  when: openvpn_role == "client"
  become: yes
  lineinfile:
    path: /etc/default/openvpn
    line: "AUTOSTART=\"openvpn-server\""
- name: 03-openvpn-clients - server-to-server-client - 00-openvpn-server-to-server-client
  when: openvpn_role == "client"
  command:
    cmd: "{{ openvpn_clients }}/server-to-server-client/00-openvpn-server-to-server-client"
    stdin: |
      "{{ openvpn_target_ip }}"
      y
