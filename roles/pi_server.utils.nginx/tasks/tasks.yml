- name: docker compose file
  become: yes
  ansible.builtin.template:
    src: docker-compose.yml.j2
    dest: "{{ compose_dir }}/docker-compose.yml"
    owner: root
    group: root
    mode: a=r

- name: docker compose
  become: yes
  community.docker.docker_compose:
    project_src: "{{ compose_dir }}"

- name: forward nginx port
  include_role:
    name: pi_server.utils.docker_port_forward
  vars:
    compose_file: "{{ compose_dir }}/docker-compose.yml"
    service: nginx
    container_port: "{{ pi_server_utils_nginx_container_port }}"

- include_role:
    name: pi_server.utils.monitor_docker_compose
  vars:
    compose_file: "{{ compose_dir }}/docker-compose.yml"
