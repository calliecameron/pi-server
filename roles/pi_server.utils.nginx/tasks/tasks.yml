- include_role:
    name: pi_server.apps.docker

- include_role:
    name: pi_server.apps.traefik

- name: docker compose file
  become: yes
  ansible.builtin.template:
    src: docker-compose.yml.j2
    dest: "{{ args.compose_dir }}/docker-compose.yml"
    owner: root
    group: root
    mode: a=r

- name: docker compose
  become: yes
  community.docker.docker_compose:
    project_src: "{{ args.compose_dir }}"

- name: monitoring
  include_role:
    name: pi_server.apps.monitoring.monitor_docker_compose
  vars:
    compose_file: "{{ args.compose_dir }}/docker-compose.yml"
