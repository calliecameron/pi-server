- ansible.builtin.include_role:
    name: pi_server.apps.docker

- ansible.builtin.include_role:
    name: pi_server.apps.traefik

- name: docker compose file
  become: yes
  ansible.builtin.template:
    src: docker-compose.yml.j2
    dest: "{{ args.compose_dir }}/docker-compose.yml"
    owner: root
    group: root
    mode: a=r

- name: docker compose
  become: yes
  community.docker.docker_compose:
    project_src: "{{ args.compose_dir }}"
    # TODO set this to yes once pull_policy is supported
    pull: no
    remove_orphans: yes
    restarted: no

- name: monitoring
  ansible.builtin.include_role:
    name: pi_server.apps.monitoring.monitor_docker_compose
  vars:
    compose_file: "{{ args.compose_dir }}/docker-compose.yml"
