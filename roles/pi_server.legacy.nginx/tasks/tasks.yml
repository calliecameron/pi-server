- include_role:
    name: pi_server.legacy.cron

- name: install nginx
  become: yes
  ansible.builtin.package:
    name: nginx
    state: present
  notify: reload nginx

- name: pause nginx on cron
  include_role:
    name: pi_server.utils.create_file
  vars:
    path: "{{ pi_server_legacy_cron_pause_dir }}/nginx.service"
    owner: root
    group: root
    mode: a=r

- name: generic nginx config
  become: yes
  ansible.builtin.copy:
    src: nginx.conf
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: a=r
  notify: reload nginx

- name: delete pre-installed site
  become: yes
  ansible.builtin.file:
    path: /etc/nginx/sites-enabled/default
    state: absent
  notify: reload nginx

- name: http port
  include_role:
    name: pi_server.utils.tcp_port
  vars:
    port: 80

- name: https port
  include_role:
    name: pi_server.utils.tcp_port
  vars:
    port: 443
