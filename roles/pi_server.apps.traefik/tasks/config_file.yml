- name: assemble entrypoints file
  become: yes
  ansible.builtin.assemble:
    src: "{{ pi_server_apps_traefik_entrypoints_dir }}"
    dest: "{{ pi_server_apps_traefik_entrypoints_file }}"
    owner: root
    group: root
    mode: a=r

- name: get entrypoints
  become: yes
  ansible.builtin.command:
    cmd: "cat '{{ pi_server_apps_traefik_entrypoints_file }}'"
  register: raw_entrypoints
  changed_when: False

- name: config file
  become: yes
  ansible.builtin.template:
    src: traefik.yml.j2
    dest: "{{ pi_server_apps_traefik_config }}"
    owner: root
    group: root
    mode: a=r
  vars:
    entrypoint_lines: "{{ raw_entrypoints.stdout_lines }}"
  notify: reload traefik
