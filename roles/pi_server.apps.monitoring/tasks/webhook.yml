- name: install webhook
  become: yes
  ansible.builtin.package:
    name: webhook
    state: present

- name: webhook systemd unit
  become: yes
  ansible.builtin.template:
    src: webhook.service.j2
    dest: /etc/systemd/system/webhook.service
    owner: root
    group: root
    mode: a=r
  notify: reload webhook

- name: configure webhook
  become: yes
  ansible.builtin.template:
    src: webhook.conf.j2
    dest: /etc/webhook.conf
    owner: root
    group: root
    mode: a=r
  notify: reload webhook

- name: webhook alert script
  become: yes
  ansible.builtin.template:
    src: webhook_alert.j2
    dest: "{{ pi_server_apps_monitoring_webhook_script }}"
    owner: root
    group: root
    mode: a=rx

- include_role:
    name: pi_server.utils.monitor_systemd_service
  vars:
    systemd_service: webhook
