- name: forward prometheus port
  include_role:
    name: pi_server.utils.docker_port_forward
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: prometheus
    container_port: "{{ pi_server_apps_monitoring_prometheus_port }}"
  when: pi_server_monitoring_open_ports

- name: let prometheus scrape docker
  include_role:
    name: pi_server.utils.docker_link_host_port
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: prometheus
    host_port: "{{ pi_server_apps_docker_metrics_port }}"

- name: let prometheus scrape node exporter
  include_role:
    name: pi_server.utils.docker_link_host_port
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: prometheus
    host_port: "{{ pi_server_apps_monitoring_node_exporter_port }}"

- name: forward grafana port
  include_role:
    name: pi_server.utils.docker_port_forward
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: grafana
    container_port: "{{ pi_server_apps_monitoring_grafana_port }}"
  when: pi_server_monitoring_open_ports

- name: forward alertmanager port
  include_role:
    name: pi_server.utils.docker_port_forward
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: alertmanager
    container_port: "{{ pi_server_apps_monitoring_alertmanager_port }}"
  when: pi_server_monitoring_open_ports

- name: let alertmanager call webhook
  include_role:
    name: pi_server.utils.docker_link_host_port
  vars:
    compose_file: "{{ pi_server_apps_monitoring_docker_compose }}"
    service: alertmanager
    host_port: "{{ pi_server_apps_monitoring_webhook_port }}"
