# MANAGED BY ANSIBLE, CHANGES WILL BE OVERWRITTEN

services:
  "{{ pi_server_apps_minecraft_server_service }}":
    image: "itzg/minecraft-server:{{ pi_server_apps_minecraft_server_docker_version }}"
    restart: always
    user: "{{ minecraft_user.uid }}:{{ minecraft_user.group }}"
    command:
      - "--forceUpgrade"
    ports:
      - "{{ pi_server_apps_minecraft_server_port }}:{{ pi_server_apps_minecraft_server_port }}"
    volumes:
      - "{{ pi_server_apps_minecraft_server_data_dir }}:/data"
      - "{{ pi_server_apps_minecraft_server_config_dir }}:/config:ro"
      - "{{ pi_server_apps_minecraft_server_plugins_dir }}:/plugins:ro"
      - "/etc/timezone:/etc/timezone:ro"
    environment:
      EULA: "TRUE"
      TYPE: "SPIGOT"
      VERSION: "{{ pi_server_apps_minecraft_server_version }}"
      MEMORY: "{{ pi_server_minecraft_server_java_heap_mb }}m"
      ENABLE_ROLLING_LOGS: "true"
      STOP_DURATION: "{{ pi_server_minecraft_server_stop_time_seconds }}"
      COPY_CONFIG_DEST: "/data"
      SYNC_SKIP_NEWER_IN_DESTINATION: "false"
    stop_grace_period: "{{ pi_server_minecraft_server_stop_time_seconds }}s"
    deploy:
      replicas: 1
