- include_role:
    name: pi_server.base

- name: user
  become: yes
  ansible.builtin.user:
    name: "{{ pi_server_apps_updates_user }}"
    password: !
    password_lock: yes
    shell: /usr/sbin/nologin
    create_home: no

- name: sudoers
  include_role:
    name: pi_server.utils.sudoers_fragment
  vars:
    src: sudoers.j2
    user: "{{ pi_server_apps_updates_user }}"

- name: listchanges.conf
  become: yes
  ansible.builtin.copy:
    src: listchanges.conf
    dest: /etc/apt/listchanges.conf
    owner: root
    group: root
    mode: a=r

- name: cronjob
  include_role:
    name: pi_server.utils.cronjob
  vars:
    job: updates
    src: updates.j2
    user: "{{ pi_server_apps_updates_user }}"

- name: dashboard
  include_role:
    name: pi_server.utils.custom_dashboard
  vars:
    src: updates.json

- name: alerts
  include_role:
    name: pi_server.utils.custom_alerts
  vars:
    src: updates-alerts-custom.yml
    job: updates
